<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de Página Estática</title>
    <style>
        body { box-sizing: border-box; margin: 0; padding: 0; display: flex; flex-direction: column; align-items: center; font-family: "Inter", serif; background-color: #f5f5f5; color: #333;}
        .container { width: 660px; display: flex; flex-direction: column; padding: 20px; }
        label { font-weight: bold; }
        input, textarea { padding: 8px 12px; margin: 5px 0; font-family: "Inter", serif; font-size: 15px; outline: none; border: 1px solid #c5c5c5; border-radius: 5px; }
        textarea { resize: vertical; }
        input:hover, textarea:hover { border-color: #333; }
        input:focus, textarea:focus { border-color: rgb(0, 68, 255); }
        button { display: flex; align-items: center; gap: 10px; justify-content: center; background-color: rgb(0, 68, 255); color: white; padding: 10px; border: none; outline: none; cursor: pointer; border-radius: 5px; height: 44px; font-family: "Inter", serif; font-size: 15px; font-weight: bold; }
        button:hover { background-color: rgb(21, 83, 255); }
        .char-count { text-align: right; margin-bottom: 10px; font-size: 11px; }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">
</head>
<body>

    <div class="container">

        <label for="title">Título</label>
        <input type="text" id="title" placeholder="60 caracteres no máximo" maxlength="60" required>
        <div class="char-count"><span id="titleCount">0</span>/60</div>

        <label for="description">Descrição</label>
        <textarea id="description" rows="2" placeholder="160 caracteres no máximo" maxlength="160" required></textarea>
        <div class="char-count"><span id="descriptionCount">0</span>/160</div>

        <label for="slug">Slug</label>
        <input type="text" id="slug" placeholder="6 palavras no máximo" required style="margin-bottom: 20px;">

        <label for="content">Conteúdo</label>
        <textarea id="content" rows="10" placeholder="Conteúdo em HTML" required style="margin-bottom: 20px;"></textarea>

        <label for="url">Link do site</label>
        <input type="text" id="url" placeholder="Link base do site:" value="https://link.com/" style="margin-bottom: 20px;" required>

        <button onclick="handlePublish()">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"  stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" /></svg>
            Publicar no GitHub</button>

    </div>

    <script>

        // Função para atualizar contadores
        function updateCharCount(elementId, counterId) {
            const element = document.getElementById(elementId);
            const counter = document.getElementById(counterId);
            
            function update() {
                counter.textContent = element.value.length;
            }
            
            element.addEventListener('input', update);
            update(); // Inicializa o contador
        }

        // Inicializar todos os contadores
        updateCharCount('title', 'titleCount');
        updateCharCount('description', 'descriptionCount');

        let generatedHTML = "";

        function generateHTML() {
            const slug = document.getElementById("slug").value.trim();
            const title = document.getElementById("title").value.trim();
            const description = document.getElementById("description").value.trim();
            const content = document.getElementById("content").value.trim();
            const url = document.getElementById("url").value.trim();

            if (!slug || !title || !description || !content || !url) {
                alert("Preencha todos os campos.");
                return null;
            }

            // Escapar crases no conteúdo
            const escapedContent = content.replace(/`/g, '\\`');

            // Gerar o HTML corretamente
            return `<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${title}</title>
    <link rel="preload" href="/estilo.css" as="style">
    <link rel="stylesheet" href="/estilo.css">
    <meta name="description" content="${description}">
    <meta property="og:title" content="${title}">
    <meta property="og:description" content="${description}">
    <meta property="og:url" content="${url}">
    <meta property="og:image" content="/imagens/og-compartilhar.png">
    <meta property="og:type" content="website">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="${url}${slug}">
    <link rel="icon" href="/imagens/logo.png" sizes="48x48" type="image/png">
    <link rel="apple-touch-icon" href="/imagens/logo.png">
    <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "WebSite",
            "name": "${title}",
            "url": "${url}${slug}",
            "description": "${description}"
        }
    <\/script>
</head>
<body>
    <article>
        ${escapedContent}
    </article>
</body>
</html>`;
        }

async function handlePublish() {
    const generatedHTML = generateHTML();
    if (!generatedHTML) return;

    const slug = document.getElementById("slug").value.trim();
    const htmlContent = btoa(unescape(encodeURIComponent(generatedHTML)));

    const response = await fetch('https://wb6k7mulh5.execute-api.sa-east-1.amazonaws.com/estagioGithubPostTest', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            slug: slug,
            html_content: htmlContent,
        }),
    });

    if (response.ok) {
        alert("Página enviada com sucesso! O GitHub Actions vai publicar a página.");
    } else {
        const errorData = await response.json();
        alert(`Erro ao enviar: ${errorData.message}`);
    }
}
    </script>
</body>
</html>
